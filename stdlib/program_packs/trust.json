{
  "programs": [
    {
      "name": "TrustedTransfer",
      "description": "Trust Architecture: Transfer with circuit breaker + shadow validation",
      "inputs": [
        {
          "name": "from_id",
          "type": "string",
          "required": true
        },
        {
          "name": "to_id",
          "type": "string",
          "required": true
        },
        {
          "name": "amount",
          "type": "number",
          "required": true
        }
      ],
      "context": [
        {
          "name": "sender",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "recipient",
          "source": "ledger",
          "path": "entities.{to_id}"
        },
        {
          "name": "breaker",
          "source": "ledger",
          "path": "breakers.{from_id}"
        },
        {
          "name": "shadow",
          "source": "ledger",
          "path": "shadows.{from_id}"
        },
        {
          "name": "amount",
          "source": "input",
          "path": "amount"
        }
      ],
      "evaluate": "CHIP:trusted_transfer",
      "on_allow": [
        {
          "type": "decrement",
          "target": "entities.{from_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "entities.{to_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "breakers.{from_id}.hourly_volume",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "breakers.{from_id}.daily_volume",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "breakers.{from_id}.tx_this_minute",
          "amount": {
            "type": "literal",
            "value": 1
          }
        },
        {
          "type": "emit",
          "event": "trusted_transfer_success",
          "data": {
            "from": "{from_id}",
            "to": "{to_id}",
            "amount": "{amount}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "trusted_transfer_denied",
          "data": {
            "reason": "{proof.failed_gates}",
            "from": "{from_id}"
          }
        }
      ]
    },
    {
      "name": "MultisigTransfer",
      "description": "Trust Architecture: High-value transfer requiring multiple signatures",
      "inputs": [
        {
          "name": "from_id",
          "type": "string",
          "required": true
        },
        {
          "name": "to_id",
          "type": "string",
          "required": true
        },
        {
          "name": "amount",
          "type": "number",
          "required": true
        },
        {
          "name": "signatures",
          "type": "array",
          "required": true
        },
        {
          "name": "signers",
          "type": "array",
          "required": true
        },
        {
          "name": "operation_hash",
          "type": "string",
          "required": true
        }
      ],
      "context": [
        {
          "name": "sender",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "recipient",
          "source": "ledger",
          "path": "entities.{to_id}"
        },
        {
          "name": "amount",
          "source": "input",
          "path": "amount"
        },
        {
          "name": "signatures",
          "source": "input",
          "path": "signatures"
        },
        {
          "name": "signers",
          "source": "input",
          "path": "signers"
        },
        {
          "name": "operation_hash",
          "source": "input",
          "path": "operation_hash"
        },
        {
          "name": "required_signatures",
          "source": "computed",
          "expression": {
            "type": "call",
            "function": "max",
            "args": [
              {
                "type": "literal",
                "value": 2
              },
              {
                "type": "call",
                "function": "div",
                "args": [
                  {
                    "type": "path",
                    "path": [
                      "amount"
                    ]
                  },
                  {
                    "type": "literal",
                    "value": 50000
                  }
                ]
              }
            ]
          }
        }
      ],
      "evaluate": "CHIP:multisig_verify_crypto",
      "on_allow": [
        {
          "type": "decrement",
          "target": "entities.{from_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "entities.{to_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "emit",
          "event": "multisig_transfer_success",
          "data": {
            "from": "{from_id}",
            "to": "{to_id}",
            "amount": "{amount}",
            "signers": "{signers}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "multisig_transfer_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "InitializeBreaker",
      "description": "Trust Architecture: Initialize circuit breaker for an agent",
      "inputs": [
        {
          "name": "agent_id",
          "type": "string",
          "required": true
        },
        {
          "name": "single_tx_limit",
          "type": "number",
          "required": true
        },
        {
          "name": "hourly_limit",
          "type": "number",
          "required": true
        },
        {
          "name": "daily_limit",
          "type": "number",
          "required": true
        },
        {
          "name": "tx_per_minute_limit",
          "type": "number",
          "required": true
        }
      ],
      "context": [
        {
          "name": "agent",
          "source": "ledger",
          "path": "entities.{agent_id}"
        }
      ],
      "evaluate": "CHIP:create_wallet",
      "on_allow": [
        {
          "type": "create",
          "entity_type": "breakers",
          "id": {
            "type": "path",
            "path": [
              "input",
              "agent_id"
            ]
          },
          "data": {
            "single_tx_limit": "{single_tx_limit}",
            "hourly_limit": "{hourly_limit}",
            "daily_limit": "{daily_limit}",
            "tx_per_minute_limit": "{tx_per_minute_limit}",
            "hourly_volume": 0,
            "daily_volume": 0,
            "tx_this_minute": 0,
            "state": "closed",
            "created_at": "{now}"
          }
        },
        {
          "type": "emit",
          "event": "breaker_initialized",
          "data": {
            "agent": "{agent_id}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "breaker_init_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "TripBreaker",
      "description": "Trust Architecture: Trip circuit breaker to OPEN state",
      "inputs": [
        {
          "name": "agent_id",
          "type": "string",
          "required": true
        },
        {
          "name": "reason",
          "type": "string",
          "required": true
        }
      ],
      "context": [
        {
          "name": "breaker",
          "source": "ledger",
          "path": "breakers.{agent_id}"
        }
      ],
      "evaluate": "CHIP:circuit_breaker",
      "on_allow": [
        {
          "type": "set",
          "target": "breakers.{agent_id}.state",
          "value": {
            "type": "literal",
            "value": "open"
          }
        },
        {
          "type": "emit",
          "event": "breaker_tripped",
          "data": {
            "agent": "{agent_id}",
            "reason": "{reason}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "breaker_trip_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "ResetBreaker",
      "description": "Trust Architecture: Reset circuit breaker to CLOSED state",
      "inputs": [
        {
          "name": "agent_id",
          "type": "string",
          "required": true
        },
        {
          "name": "caller_id",
          "type": "string",
          "required": true
        }
      ],
      "context": [
        {
          "name": "breaker",
          "source": "ledger",
          "path": "breakers.{agent_id}"
        },
        {
          "name": "caller",
          "source": "ledger",
          "path": "entities.{caller_id}"
        }
      ],
      "evaluate": "CHIP:update_reputation",
      "on_allow": [
        {
          "type": "set",
          "target": "breakers.{agent_id}.state",
          "value": {
            "type": "literal",
            "value": "closed"
          }
        },
        {
          "type": "set",
          "target": "breakers.{agent_id}.hourly_volume",
          "value": {
            "type": "literal",
            "value": 0
          }
        },
        {
          "type": "set",
          "target": "breakers.{agent_id}.daily_volume",
          "value": {
            "type": "literal",
            "value": 0
          }
        },
        {
          "type": "set",
          "target": "breakers.{agent_id}.tx_this_minute",
          "value": {
            "type": "literal",
            "value": 0
          }
        },
        {
          "type": "emit",
          "event": "breaker_reset",
          "data": {
            "agent": "{agent_id}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "breaker_reset_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "InitializeShadow",
      "description": "Trust Architecture: Initialize shadow validator for an agent",
      "inputs": [
        {
          "name": "agent_id",
          "type": "string",
          "required": true
        },
        {
          "name": "avg_tx",
          "type": "number",
          "required": true
        },
        {
          "name": "std_tx",
          "type": "number",
          "required": true
        },
        {
          "name": "typical_hours",
          "type": "array",
          "required": true
        }
      ],
      "context": [
        {
          "name": "agent",
          "source": "ledger",
          "path": "entities.{agent_id}"
        }
      ],
      "evaluate": "CHIP:create_wallet",
      "on_allow": [
        {
          "type": "create",
          "entity_type": "agent_shadows",
          "id": {
            "type": "path",
            "path": [
              "input",
              "agent_id"
            ]
          },
          "data": {
            "fingerprint": {
              "avg_tx": "{avg_tx}",
              "std_tx": "{std_tx}",
              "typical_hours": "{typical_hours}",
              "known_counterparties": []
            },
            "anomaly_score": 1.0,
            "created_at": "{now}"
          }
        },
        {
          "type": "emit",
          "event": "shadow_initialized",
          "data": {
            "agent": "{agent_id}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "shadow_init_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "CapabilityGatedTransfer",
      "description": "Trust Architecture: Transfer gated by trajectory-based capabilities",
      "inputs": [
        {
          "name": "from_id",
          "type": "string",
          "required": true
        },
        {
          "name": "to_id",
          "type": "string",
          "required": true
        },
        {
          "name": "amount",
          "type": "number",
          "required": true
        }
      ],
      "context": [
        {
          "name": "agent",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "sender",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "recipient",
          "source": "ledger",
          "path": "entities.{to_id}"
        },
        {
          "name": "amount",
          "source": "input",
          "path": "amount"
        },
        {
          "name": "required_capability",
          "source": "computed",
          "expression": {
            "type": "literal",
            "value": "transfer"
          }
        }
      ],
      "evaluate": "CHIP:capability_check",
      "on_allow": [
        {
          "type": "decrement",
          "target": "entities.{from_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "entities.{to_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "entities.{from_id}.trajectory_length",
          "amount": {
            "type": "literal",
            "value": 1
          }
        },
        {
          "type": "emit",
          "event": "capability_gated_transfer",
          "data": {
            "from": "{from_id}",
            "to": "{to_id}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "capability_transfer_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "TimeDelayedTransfer",
      "description": "Trust Architecture: High-value transfer with time delay",
      "inputs": [
        {
          "name": "operation_id",
          "type": "string",
          "required": true
        },
        {
          "name": "from_id",
          "type": "string",
          "required": true
        },
        {
          "name": "to_id",
          "type": "string",
          "required": true
        },
        {
          "name": "amount",
          "type": "number",
          "required": true
        }
      ],
      "context": [
        {
          "name": "operation",
          "source": "ledger",
          "path": "pending_operations.{operation_id}"
        },
        {
          "name": "sender",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "recipient",
          "source": "ledger",
          "path": "entities.{to_id}"
        },
        {
          "name": "amount",
          "source": "input",
          "path": "amount"
        }
      ],
      "evaluate": "CHIP:time_delay_gate",
      "on_allow": [
        {
          "type": "decrement",
          "target": "entities.{from_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "increment",
          "target": "entities.{to_id}.balance",
          "amount": {
            "type": "path",
            "path": [
              "amount"
            ]
          }
        },
        {
          "type": "set",
          "target": "pending_operations.{operation_id}.status",
          "value": {
            "type": "literal",
            "value": "executed"
          }
        },
        {
          "type": "emit",
          "event": "delayed_transfer_executed",
          "data": {
            "operation": "{operation_id}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "delayed_transfer_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    },
    {
      "name": "InitiateDelayedTransfer",
      "description": "Trust Architecture: Initiate a time-delayed transfer",
      "inputs": [
        {
          "name": "operation_id",
          "type": "string",
          "required": true
        },
        {
          "name": "from_id",
          "type": "string",
          "required": true
        },
        {
          "name": "to_id",
          "type": "string",
          "required": true
        },
        {
          "name": "amount",
          "type": "number",
          "required": true
        },
        {
          "name": "delay_seconds",
          "type": "number",
          "required": true
        }
      ],
      "context": [
        {
          "name": "sender",
          "source": "ledger",
          "path": "entities.{from_id}"
        },
        {
          "name": "amount",
          "source": "input",
          "path": "amount"
        }
      ],
      "evaluate": "CHIP:transfer",
      "on_allow": [
        {
          "type": "create",
          "entity_type": "pending_operations",
          "id": {
            "type": "path",
            "path": [
              "input",
              "operation_id"
            ]
          },
          "data": {
            "type": "transfer",
            "from": "{from_id}",
            "to": "{to_id}",
            "amount": "{amount}",
            "status": "pending",
            "created_at": "{now}",
            "execute_after": "{now}"
          }
        },
        {
          "type": "emit",
          "event": "delayed_transfer_initiated",
          "data": {
            "operation": "{operation_id}",
            "delay": "{delay_seconds}"
          }
        }
      ],
      "on_deny": [
        {
          "type": "emit",
          "event": "delayed_transfer_init_denied",
          "data": {
            "reason": "{proof.failed_gates}"
          }
        }
      ]
    }
  ]
}